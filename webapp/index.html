<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Q3 Terminal - NBA Prediction System</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- ============================================================ -->
<!-- HEADER                                                        -->
<!-- ============================================================ -->
<header class="header">
  <div class="header-brand">
    <h1>Q3<span>Terminal</span></h1>
    <div class="header-status">
      <div class="status-dot offline" id="status-dot"></div>
      <span id="status-text">Connecting...</span>
    </div>
  </div>
  <nav class="header-nav">
    <button class="nav-btn active" data-view="dashboard">Dashboard</button>
    <button class="nav-btn" data-view="live">Live Games</button>
    <button class="nav-btn" data-view="signals">Signals</button>
    <button class="nav-btn" data-view="performance">Performance</button>
    <button class="nav-btn" data-view="guide">How to Use</button>
  </nav>
</header>

<!-- ============================================================ -->
<!-- MAIN CONTENT                                                  -->
<!-- ============================================================ -->
<div class="main-content">

  <!-- ========== DASHBOARD VIEW ========== -->
  <div class="view active" id="view-dashboard">
    <!-- Metrics Row -->
    <div class="metrics-row">
      <div class="metric-card">
        <div class="metric-label">ML Leader Accuracy</div>
        <div class="metric-value positive" id="metric-ml-acc">96.0%</div>
        <div class="metric-sub">24/25 OOS</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Spread Accuracy</div>
        <div class="metric-value positive" id="metric-spread-acc">71.9%</div>
        <div class="metric-sub">233/324 @ -110</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Total P&L</div>
        <div class="metric-value positive" id="metric-pnl">+223.6u</div>
        <div class="metric-sub">All signal types combined</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Overall ROI</div>
        <div class="metric-value positive" id="metric-roi">+34.0%</div>
        <div class="metric-sub">658 total signals</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Live Games</div>
        <div class="metric-value" id="metric-live">0</div>
        <div class="metric-sub" id="metric-live-sub">No games today</div>
      </div>
    </div>

    <!-- Active Signals -->
    <div class="card">
      <div class="card-header">
        <span class="card-title">Active Signals</span>
        <span class="card-badge" style="background:var(--green-bg);color:var(--green)" id="active-count">0 active</span>
      </div>
      <div class="card-body" id="active-signals-container">
        <div class="empty-state">
          <h3>No active signals</h3>
          <p>Signals are generated at the end of Q3. Monitor live games below for upcoming opportunities.</p>
        </div>
      </div>
    </div>

    <!-- Today's Games Grid -->
    <div class="card">
      <div class="card-header">
        <span class="card-title">Today's Games</span>
        <span class="card-badge" style="color:var(--text-muted)" id="games-count">Loading...</span>
      </div>
      <div class="card-body">
        <div class="games-grid" id="games-grid">
          <div class="empty-state">
            <h3>Loading games...</h3>
            <p><span class="loading-spinner"></span></p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== LIVE GAMES VIEW ========== -->
  <div class="view" id="view-live">
    <div class="card">
      <div class="card-header">
        <span class="card-title">Live Game Monitor</span>
        <span class="card-badge" style="color:var(--text-muted)" id="live-count">0 live</span>
      </div>
      <div class="card-body">
        <div class="games-grid" id="live-games-grid">
          <div class="empty-state">
            <h3>No live games</h3>
            <p>Live game analysis with real-time Q3 signal generation will appear here during NBA games.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Live Signals -->
    <div class="card" id="live-signals-card" style="display:none">
      <div class="card-header">
        <span class="card-title">Live Signals (This Session)</span>
      </div>
      <div class="card-body" id="live-signals-container"></div>
    </div>
  </div>

  <!-- ========== SIGNALS (Historical) VIEW ========== -->
  <div class="view" id="view-signals">
    <div class="filter-bar">
      <button class="filter-btn active" data-filter="all">All</button>
      <button class="filter-btn" data-filter="SPREAD">Spread</button>
      <button class="filter-btn" data-filter="ML_LEADER">ML Leader</button>
      <button class="filter-btn" data-filter="ML_TRAILER">ML Trailer</button>
      <button class="filter-btn" data-filter="Q4_TOTAL">Q4 Total</button>
      <span style="margin-left:auto;font-size:12px;color:var(--text-muted);font-family:var(--font-mono)" id="filter-summary">658 signals</span>
    </div>

    <div class="card">
      <div class="card-header">
        <span class="card-title">Historical OOS Signals (Walk-Forward Validated)</span>
      </div>
      <div class="card-body" style="overflow-x:auto">
        <table class="data-table" id="signals-table">
          <thead>
            <tr>
              <th>Game</th>
              <th>Type</th>
              <th>Pick</th>
              <th>Confidence</th>
              <th>Edge</th>
              <th>Q3 Lead</th>
              <th>Regime</th>
              <th>Odds</th>
              <th>Result</th>
            </tr>
          </thead>
          <tbody id="signals-tbody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ========== PERFORMANCE VIEW ========== -->
  <div class="view" id="view-performance">
    <div class="stats-grid" id="performance-stats">
      <!-- Signal Type Breakdown -->
      <div class="stat-section">
        <div class="stat-section-title">Spread Signals (-110)</div>
        <div class="stat-row"><span class="stat-label">Record</span><span class="stat-value">233/324</span></div>
        <div class="stat-row"><span class="stat-label">Accuracy</span><span class="stat-value positive">71.9%</span></div>
        <div class="stat-row"><span class="stat-label">P&L</span><span class="stat-value positive">+120.8u</span></div>
        <div class="stat-row"><span class="stat-label">ROI</span><span class="stat-value positive">+37.3%</span></div>
        <div class="accuracy-bar"><div class="accuracy-bar-fill" style="width:71.9%;background:var(--green)"></div></div>
      </div>

      <div class="stat-section">
        <div class="stat-section-title">ML Leader (Variable Odds)</div>
        <div class="stat-row"><span class="stat-label">Record</span><span class="stat-value">24/25</span></div>
        <div class="stat-row"><span class="stat-label">Accuracy</span><span class="stat-value positive">96.0%</span></div>
        <div class="stat-row"><span class="stat-label">P&L</span><span class="stat-value positive">+4.7u</span></div>
        <div class="stat-row"><span class="stat-label">ROI</span><span class="stat-value positive">+18.9%</span></div>
        <div class="accuracy-bar"><div class="accuracy-bar-fill" style="width:96%;background:var(--green)"></div></div>
      </div>

      <div class="stat-section">
        <div class="stat-section-title">ML Trailer Value (Plus Odds)</div>
        <div class="stat-row"><span class="stat-label">Record</span><span class="stat-value">21/55</span></div>
        <div class="stat-row"><span class="stat-label">Accuracy</span><span class="stat-value">38.2%</span></div>
        <div class="stat-row"><span class="stat-label">P&L</span><span class="stat-value positive">+10.4u</span></div>
        <div class="stat-row"><span class="stat-label">ROI</span><span class="stat-value positive">+18.8%</span></div>
        <div class="accuracy-bar"><div class="accuracy-bar-fill" style="width:38.2%;background:var(--yellow)"></div></div>
      </div>

      <div class="stat-section">
        <div class="stat-section-title">Q4 Total O/U (-110)</div>
        <div class="stat-row"><span class="stat-label">Record</span><span class="stat-value">179/254</span></div>
        <div class="stat-row"><span class="stat-label">Accuracy</span><span class="stat-value positive">70.5%</span></div>
        <div class="stat-row"><span class="stat-label">P&L</span><span class="stat-value positive">+87.7u</span></div>
        <div class="stat-row"><span class="stat-label">ROI</span><span class="stat-value positive">+34.5%</span></div>
        <div class="accuracy-bar"><div class="accuracy-bar-fill" style="width:70.5%;background:var(--green)"></div></div>
      </div>
    </div>

    <!-- Regime Breakdown -->
    <div class="card" style="margin-top:16px">
      <div class="card-header">
        <span class="card-title">Accuracy by Game Regime at Q3 End</span>
      </div>
      <div class="card-body" style="overflow-x:auto">
        <table class="data-table">
          <thead>
            <tr>
              <th>Regime</th>
              <th>Lead Range</th>
              <th>Spread W/L</th>
              <th>Spread Acc</th>
              <th>ML Leader W/L</th>
              <th>ML Leader Acc</th>
            </tr>
          </thead>
          <tbody id="regime-tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- Model Info -->
    <div class="card" style="margin-top:16px">
      <div class="card-header">
        <span class="card-title">Model Architecture</span>
      </div>
      <div class="card-body">
        <div class="two-col">
          <div>
            <h4 style="margin-bottom:12px;color:var(--text-secondary)">Ensemble Components</h4>
            <ul style="list-style:none;padding:0">
              <li style="padding:6px 0;border-bottom:1px solid var(--border);font-family:var(--font-mono);font-size:13px">XGBoost (500 trees, depth=4)</li>
              <li style="padding:6px 0;border-bottom:1px solid var(--border);font-family:var(--font-mono);font-size:13px">LightGBM (500 trees, depth=4)</li>
              <li style="padding:6px 0;border-bottom:1px solid var(--border);font-family:var(--font-mono);font-size:13px">Random Forest (500 trees, depth=6)</li>
              <li style="padding:6px 0;border-bottom:1px solid var(--border);font-family:var(--font-mono);font-size:13px">Hist Gradient Boosting</li>
              <li style="padding:6px 0;font-family:var(--font-mono);font-size:13px">Logistic Regression (calibrated)</li>
            </ul>
          </div>
          <div>
            <h4 style="margin-bottom:12px;color:var(--text-secondary)">Novel Features (96 total)</h4>
            <ul style="list-style:none;padding:0">
              <li style="padding:6px 0;border-bottom:1px solid var(--border);font-family:var(--font-mono);font-size:13px">Game Flow DNA (Hurst, FFT, entropy)</li>
              <li style="padding:6px 0;border-bottom:1px solid var(--border);font-family:var(--font-mono);font-size:13px">Technical Analysis (RSI, Bollinger, MACD)</li>
              <li style="padding:6px 0;border-bottom:1px solid var(--border);font-family:var(--font-mono);font-size:13px">Ornstein-Uhlenbeck mean reversion</li>
              <li style="padding:6px 0;border-bottom:1px solid var(--border);font-family:var(--font-mono);font-size:13px">Lead dynamics + stability analysis</li>
              <li style="padding:6px 0;font-family:var(--font-mono);font-size:13px">Scoring patterns + interaction features</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== HOW TO USE VIEW ========== -->
  <div class="view" id="view-guide">
    <div class="guide-section">
      <h3>What is Q3 Terminal?</h3>
      <p>Q3 Terminal is an ML-powered prediction system that analyzes NBA games at the end of the 3rd quarter
         to generate high-confidence trading signals. The system uses a 5-model ensemble trained on 2,177 games
         with 96 engineered features, including novel "Game Flow DNA" time-series analysis and technical indicators.</p>
      <div class="highlight-box">
        <strong>Key Results (Out-of-Sample, Walk-Forward Validated):</strong>
        <ul style="margin-top:8px">
          <li><strong>ML Leader</strong>: 96.0% accuracy (24/25) - Predicts game winner in competitive games</li>
          <li><strong>Spread</strong>: 71.9% accuracy at -110 odds = +37.3% ROI</li>
          <li><strong>Q4 Total</strong>: 70.5% accuracy at -110 odds = +34.5% ROI</li>
          <li><strong>ML Trailer Value</strong>: 38.2% at plus odds = +18.8% ROI</li>
        </ul>
      </div>
    </div>

    <div class="guide-section">
      <h3>Signal Types</h3>
      <ol>
        <li><strong>SPREAD</strong> (-110 odds): Predicts whether the leading team covers the estimated live spread.
            These are standard -110 spread bets placed at the end of Q3. The model predicts the final margin
            and compares it to the market's expected spread.</li>
        <li><strong>ML LEADER</strong> (variable odds): High-confidence prediction that the leading team wins
            the game. Only fires when the model's win probability significantly exceeds the market-implied
            probability. These signals have 96% accuracy but fewer opportunities.</li>
        <li><strong>ML TRAILER VALUE</strong> (plus odds): Identifies games where the trailing team has a
            higher comeback probability than the market implies. Lower accuracy but high payout at plus odds.</li>
        <li><strong>Q4 TOTAL</strong> (-110 odds): Predicts whether Q4 scoring will be over or under the
            estimated live total. Based on pace analysis and game-state factors.</li>
      </ol>
    </div>

    <div class="guide-section">
      <h3>How Signals Are Generated</h3>
      <ol>
        <li>At the end of Q3 (or when Q4 begins), the system extracts 96 features from the play-by-play data</li>
        <li>Features include scoring patterns, lead dynamics, "Game Flow DNA" (Hurst exponent, FFT analysis,
            Shannon entropy), and technical analysis indicators (RSI, Bollinger Bands, MACD analogs)</li>
        <li>A 5-model ensemble (XGBoost, LightGBM, Random Forest, Hist Gradient Boosting, Logistic Regression)
            generates predictions with calibrated probabilities</li>
        <li>Signals are only generated when the model's prediction significantly diverges from the estimated
            market price (minimum 8% edge for spreads, 10% for moneyline)</li>
        <li>Each signal includes confidence level, edge, estimated odds, and recommended bet type</li>
      </ol>
      <div class="highlight-box warning">
        <strong>Important:</strong> All results shown are from strict walk-forward out-of-sample testing.
        The model was trained on 2021-22 season data and tested on 2022-23 season data with zero look-ahead bias.
        Past performance does not guarantee future results.
      </div>
    </div>

    <div class="guide-section">
      <h3>How to Place Bets</h3>
      <ol>
        <li>Watch the live games dashboard during NBA game nights</li>
        <li>When a game reaches end of Q3 (or start of Q4), the system will analyze the game state</li>
        <li>If a signal fires, you'll see it highlighted with the recommended bet</li>
        <li>Place the indicated bet on your preferred sportsbook's live betting section</li>
        <li>For SPREAD and Q4 TOTAL signals, look for -110 odds (standard)</li>
        <li>For ML LEADER signals, take the best available moneyline price on the indicated team</li>
        <li>For ML TRAILER signals, take the trailing team's moneyline at the best plus odds available</li>
      </ol>
      <div class="highlight-box info">
        <strong>Bankroll Management:</strong> Risk 1-2% of bankroll per signal. ML LEADER signals
        (96% accuracy) can warrant higher sizing (2-3%). Never risk more than 5% on a single bet.
      </div>
    </div>
  </div>

</div>

<!-- ============================================================ -->
<!-- SCRIPTS                                                       -->
<!-- ============================================================ -->
<script src="js/nba-api.js"></script>
<script src="js/q3-terminal-engine.js"></script>
<script src="js/main.js"></script>

</body>
</html>
