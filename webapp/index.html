<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Q3 Terminal - NBA Prediction System</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- ============================================================ -->
<!-- HEADER                                                        -->
<!-- ============================================================ -->
<header class="header">
  <div class="header-brand">
    <h1>Q3<span>Terminal</span></h1>
    <div class="header-status">
      <div class="status-dot offline" id="status-dot"></div>
      <span id="status-text">Connecting...</span>
    </div>
  </div>
  <nav class="header-nav">
    <button class="nav-btn active" data-view="dashboard">Dashboard</button>
    <button class="nav-btn" data-view="live">Live Games</button>
    <button class="nav-btn" data-view="signals">Signals</button>
    <button class="nav-btn" data-view="performance">Performance</button>
    <button class="nav-btn" data-view="guide">How to Use</button>
  </nav>
</header>

<!-- ============================================================ -->
<!-- MAIN CONTENT                                                  -->
<!-- ============================================================ -->
<div class="main-content">

  <!-- ========== DASHBOARD VIEW ========== -->
  <div class="view active" id="view-dashboard">
    <!-- Metrics Row -->
    <div class="metrics-row">
      <div class="metric-card">
        <div class="metric-label">ML Leader Win Rate</div>
        <div class="metric-value positive" id="metric-ml-acc">96.0%</div>
        <div class="metric-sub">24/25 | moneyline bets</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Spread Win Rate</div>
        <div class="metric-value positive" id="metric-spread-acc">71.9%</div>
        <div class="metric-sub">233/324 | -110 std juice</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Total P&L (flat 1u bets)</div>
        <div class="metric-value positive" id="metric-pnl">+223.6u</div>
        <div class="metric-sub">All signal types combined</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Overall ROI</div>
        <div class="metric-value positive" id="metric-roi">+34.0%</div>
        <div class="metric-sub">658 signals (OOS validated)</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Live Games</div>
        <div class="metric-value" id="metric-live">0</div>
        <div class="metric-sub" id="metric-live-sub">No games today</div>
      </div>
    </div>

    <!-- Active Signals -->
    <div class="card">
      <div class="card-header">
        <span class="card-title">Active Signals</span>
        <span class="card-badge" style="background:var(--green-bg);color:var(--green)" id="active-count">0 active</span>
      </div>
      <div class="card-body" id="active-signals-container">
        <div class="empty-state">
          <h3>No active signals</h3>
          <p>Signals are generated at the end of Q3. Monitor live games below for upcoming opportunities.</p>
        </div>
      </div>
    </div>

    <!-- Today's Games Grid -->
    <div class="card">
      <div class="card-header">
        <span class="card-title">Today's Games</span>
        <span class="card-badge" style="color:var(--text-muted)" id="games-count">Loading...</span>
      </div>
      <div class="card-body">
        <div class="games-grid" id="games-grid">
          <div class="empty-state">
            <h3>Loading games...</h3>
            <p><span class="loading-spinner"></span></p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== LIVE GAMES VIEW ========== -->
  <div class="view" id="view-live">
    <div class="card">
      <div class="card-header">
        <span class="card-title">Live Game Monitor</span>
        <span class="card-badge" style="color:var(--text-muted)" id="live-count">0 live</span>
      </div>
      <div class="card-body">
        <div class="games-grid" id="live-games-grid">
          <div class="empty-state">
            <h3>No live games</h3>
            <p>Live game analysis with real-time Q3 signal generation will appear here during NBA games.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Live Signals -->
    <div class="card" id="live-signals-card" style="display:none">
      <div class="card-header">
        <span class="card-title">Live Signals (This Session)</span>
      </div>
      <div class="card-body" id="live-signals-container"></div>
    </div>
  </div>

  <!-- ========== SIGNALS (Historical) VIEW ========== -->
  <div class="view" id="view-signals">
    <div class="filter-bar">
      <button class="filter-btn active" data-filter="all">All</button>
      <button class="filter-btn" data-filter="SPREAD">Spread</button>
      <button class="filter-btn" data-filter="ML_LEADER">ML Leader</button>
      <button class="filter-btn" data-filter="ML_TRAILER">ML Trailer</button>
      <button class="filter-btn" data-filter="Q4_TOTAL">Q4 Total</button>
      <span style="margin-left:auto;font-size:12px;color:var(--text-muted);font-family:var(--font-mono)" id="filter-summary">658 signals</span>
    </div>

    <div class="card">
      <div class="card-header">
        <span class="card-title">Historical OOS Signals (Walk-Forward Validated)</span>
      </div>
      <div class="card-body" style="overflow-x:auto">
        <table class="data-table" id="signals-table">
          <thead>
            <tr>
              <th>Game</th>
              <th>Type</th>
              <th>Bet</th>
              <th>Conf</th>
              <th>Edge</th>
              <th>Odds</th>
              <th>Result</th>
            </tr>
          </thead>
          <tbody id="signals-tbody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ========== PERFORMANCE VIEW ========== -->
  <div class="view" id="view-performance">
    <!-- Odds explanation banner -->
    <div class="odds-explainer">
      <strong>How odds work for each signal type:</strong>
      <div class="odds-explainer-grid">
        <div><span class="signal-type-badge spread">SPREAD</span> Standard -110 juice. This is what every sportsbook charges for spread bets. The line number (e.g. -7.5) is estimated from the Q3 game state.</div>
        <div><span class="signal-type-badge ml-leader">ML LEADER</span> Variable moneyline odds, estimated from win probability. Actual odds depend on sportsbook and timing. Heavy favorites may have large negative odds.</div>
        <div><span class="signal-type-badge ml-trailer">ML TRAILER</span> Plus odds (underdog). These pay more than you risk. Estimated from the market but actual odds vary. Only bet at plus odds.</div>
        <div><span class="signal-type-badge q4-total">Q4 TOTAL</span> Standard -110 juice. This is what every sportsbook charges for totals bets. The line number (e.g. O/U 54.5) is estimated from pace and game state.</div>
      </div>
    </div>

    <div class="stats-grid" id="performance-stats">
      <!-- Signal Type Breakdown -->
      <div class="stat-section">
        <div class="stat-section-title">Spread (Live Point Spread @ -110)</div>
        <div class="stat-section-sub">Bet: [Team] [spread line] at standard -110 juice</div>
        <div class="stat-row"><span class="stat-label">Record</span><span class="stat-value">233/324</span></div>
        <div class="stat-row"><span class="stat-label">Accuracy</span><span class="stat-value positive">71.9%</span></div>
        <div class="stat-row"><span class="stat-label">P&L</span><span class="stat-value positive">+120.8u</span></div>
        <div class="stat-row"><span class="stat-label">ROI</span><span class="stat-value positive">+37.3%</span></div>
        <div class="stat-row"><span class="stat-label">Break-even</span><span class="stat-value">52.4%</span></div>
        <div class="accuracy-bar"><div class="accuracy-bar-fill" style="width:71.9%;background:var(--green)"></div></div>
      </div>

      <div class="stat-section">
        <div class="stat-section-title">ML Leader (Live Moneyline, Variable Odds)</div>
        <div class="stat-section-sub">Bet: [Leading team] moneyline at best available price</div>
        <div class="stat-row"><span class="stat-label">Record</span><span class="stat-value">24/25</span></div>
        <div class="stat-row"><span class="stat-label">Accuracy</span><span class="stat-value positive">96.0%</span></div>
        <div class="stat-row"><span class="stat-label">P&L</span><span class="stat-value positive">+4.7u</span></div>
        <div class="stat-row"><span class="stat-label">ROI</span><span class="stat-value positive">+18.9%</span></div>
        <div class="stat-row"><span class="stat-label">Odds range</span><span class="stat-value">-200 to -1500</span></div>
        <div class="accuracy-bar"><div class="accuracy-bar-fill" style="width:96%;background:var(--green)"></div></div>
      </div>

      <div class="stat-section">
        <div class="stat-section-title">ML Trailer (Underdog Moneyline, Plus Odds)</div>
        <div class="stat-section-sub">Bet: [Trailing team] moneyline at plus odds (they must be the underdog)</div>
        <div class="stat-row"><span class="stat-label">Record</span><span class="stat-value">21/55</span></div>
        <div class="stat-row"><span class="stat-label">Accuracy</span><span class="stat-value">38.2%</span></div>
        <div class="stat-row"><span class="stat-label">P&L</span><span class="stat-value positive">+10.4u</span></div>
        <div class="stat-row"><span class="stat-label">ROI</span><span class="stat-value positive">+18.8%</span></div>
        <div class="stat-row"><span class="stat-label">Avg payout</span><span class="stat-value">+250 to +600</span></div>
        <div class="accuracy-bar"><div class="accuracy-bar-fill" style="width:38.2%;background:var(--yellow)"></div></div>
      </div>

      <div class="stat-section">
        <div class="stat-section-title">Q4 Total (Live Q4 O/U @ -110)</div>
        <div class="stat-section-sub">Bet: Q4 Over/Under [line] at standard -110 juice</div>
        <div class="stat-row"><span class="stat-label">Record</span><span class="stat-value">179/254</span></div>
        <div class="stat-row"><span class="stat-label">Accuracy</span><span class="stat-value positive">70.5%</span></div>
        <div class="stat-row"><span class="stat-label">P&L</span><span class="stat-value positive">+87.7u</span></div>
        <div class="stat-row"><span class="stat-label">ROI</span><span class="stat-value positive">+34.5%</span></div>
        <div class="stat-row"><span class="stat-label">Break-even</span><span class="stat-value">52.4%</span></div>
        <div class="accuracy-bar"><div class="accuracy-bar-fill" style="width:70.5%;background:var(--green)"></div></div>
      </div>
    </div>

    <!-- Regime Breakdown -->
    <div class="card" style="margin-top:16px">
      <div class="card-header">
        <span class="card-title">Accuracy by Game Regime at Q3 End</span>
      </div>
      <div class="card-body" style="overflow-x:auto">
        <table class="data-table">
          <thead>
            <tr>
              <th>Regime</th>
              <th>Lead Range</th>
              <th>Spread W/L</th>
              <th>Spread Acc</th>
              <th>ML Leader W/L</th>
              <th>ML Leader Acc</th>
            </tr>
          </thead>
          <tbody id="regime-tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- Model Info -->
    <div class="card" style="margin-top:16px">
      <div class="card-header">
        <span class="card-title">Model Architecture</span>
      </div>
      <div class="card-body">
        <div class="two-col">
          <div>
            <h4 style="margin-bottom:12px;color:var(--text-secondary)">Ensemble Components</h4>
            <ul style="list-style:none;padding:0">
              <li style="padding:6px 0;border-bottom:1px solid var(--border);font-family:var(--font-mono);font-size:13px">XGBoost (500 trees, depth=4)</li>
              <li style="padding:6px 0;border-bottom:1px solid var(--border);font-family:var(--font-mono);font-size:13px">LightGBM (500 trees, depth=4)</li>
              <li style="padding:6px 0;border-bottom:1px solid var(--border);font-family:var(--font-mono);font-size:13px">Random Forest (500 trees, depth=6)</li>
              <li style="padding:6px 0;border-bottom:1px solid var(--border);font-family:var(--font-mono);font-size:13px">Hist Gradient Boosting</li>
              <li style="padding:6px 0;font-family:var(--font-mono);font-size:13px">Logistic Regression (calibrated)</li>
            </ul>
          </div>
          <div>
            <h4 style="margin-bottom:12px;color:var(--text-secondary)">Novel Features (96 total)</h4>
            <ul style="list-style:none;padding:0">
              <li style="padding:6px 0;border-bottom:1px solid var(--border);font-family:var(--font-mono);font-size:13px">Game Flow DNA (Hurst, FFT, entropy)</li>
              <li style="padding:6px 0;border-bottom:1px solid var(--border);font-family:var(--font-mono);font-size:13px">Technical Analysis (RSI, Bollinger, MACD)</li>
              <li style="padding:6px 0;border-bottom:1px solid var(--border);font-family:var(--font-mono);font-size:13px">Ornstein-Uhlenbeck mean reversion</li>
              <li style="padding:6px 0;border-bottom:1px solid var(--border);font-family:var(--font-mono);font-size:13px">Lead dynamics + stability analysis</li>
              <li style="padding:6px 0;font-family:var(--font-mono);font-size:13px">Scoring patterns + interaction features</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== HOW TO USE VIEW ========== -->
  <div class="view" id="view-guide">
    <div class="guide-section">
      <h3>What is Q3 Terminal?</h3>
      <p>Q3 Terminal analyzes NBA games at the end of the 3rd quarter and tells you exactly what bet to place.
         It uses a 5-model ML ensemble trained on 2,177 games to find edges the live betting market misses.</p>
      <div class="highlight-box">
        <strong>Out-of-Sample Results (Walk-Forward Validated):</strong>
        <ul style="margin-top:8px">
          <li><strong>Spread signals</strong>: 71.9% win rate at -110 juice = +37.3% ROI (break-even is 52.4%)</li>
          <li><strong>ML Leader signals</strong>: 96.0% win rate at variable moneyline odds = +18.9% ROI</li>
          <li><strong>Q4 Total signals</strong>: 70.5% win rate at -110 juice = +34.5% ROI (break-even is 52.4%)</li>
          <li><strong>ML Trailer signals</strong>: 38.2% win rate at plus odds (+250 to +600 range) = +18.8% ROI</li>
        </ul>
      </div>
    </div>

    <div class="guide-section">
      <h3>Exactly What Bet to Place (By Signal Type)</h3>

      <div class="bet-guide-block">
        <div class="bet-guide-header"><span class="signal-type-badge spread">SPREAD</span> Live Point Spread</div>
        <div class="bet-guide-body">
          <div class="bet-guide-steps">
            <div class="bet-guide-step"><span class="step-num">1</span> Open your sportsbook's <strong>live betting</strong> section</div>
            <div class="bet-guide-step"><span class="step-num">2</span> Find the NBA game listed</div>
            <div class="bet-guide-step"><span class="step-num">3</span> Look for <strong>Point Spread</strong> (also called "Spread" or "Handicap")</div>
            <div class="bet-guide-step"><span class="step-num">4</span> The signal tells you the team and spread number (e.g. "LAL -7.5")</div>
            <div class="bet-guide-step"><span class="step-num">5</span> Bet that team at the spread shown. The odds should be around <strong>-110</strong></div>
          </div>
          <div class="bet-guide-example">
            <strong>Example:</strong> Signal says "LAL -7.5 (Live Spread)"<br>
            You bet: Lakers -7.5 at -110 odds. If Lakers win by 8+, you win. Risk $110 to win $100.
          </div>
          <div class="bet-guide-odds-note">
            <strong>About -110 odds:</strong> This is the standard juice every sportsbook charges for spread bets.
            It is not an estimate -- it's what you'll see at DraftKings, FanDuel, BetMGM, etc.
            Some books offer -105 reduced juice. If your book shows -115 or worse, the edge is slightly reduced.
          </div>
        </div>
      </div>

      <div class="bet-guide-block">
        <div class="bet-guide-header"><span class="signal-type-badge ml-leader">ML LEADER</span> Live Moneyline (Favorite)</div>
        <div class="bet-guide-body">
          <div class="bet-guide-steps">
            <div class="bet-guide-step"><span class="step-num">1</span> Open your sportsbook's <strong>live betting</strong> section</div>
            <div class="bet-guide-step"><span class="step-num">2</span> Find the NBA game listed</div>
            <div class="bet-guide-step"><span class="step-num">3</span> Look for <strong>Moneyline</strong> (also called "ML" or "To Win")</div>
            <div class="bet-guide-step"><span class="step-num">4</span> The signal tells you which team (the one currently leading)</div>
            <div class="bet-guide-step"><span class="step-num">5</span> Bet that team's moneyline. Odds will be negative (favorite). Shop for the best price.</div>
          </div>
          <div class="bet-guide-example">
            <strong>Example:</strong> Signal says "BOS to WIN (Moneyline)" with estimated odds -450<br>
            You bet: Celtics moneyline. Your book might show -400 to -500. Risk $450 to win $100 (at -450).
          </div>
          <div class="bet-guide-odds-note">
            <strong>About moneyline odds:</strong> These are NOT fixed at -110. They vary by sportsbook and how much
            time remains. The system estimates what the market odds should be from the game state. The signal only fires
            when model confidence significantly exceeds the estimated market probability, so you have edge even at the book's actual odds.
            Shop multiple books for the least negative (best) price.
          </div>
        </div>
      </div>

      <div class="bet-guide-block">
        <div class="bet-guide-header"><span class="signal-type-badge ml-trailer">ML TRAILER</span> Live Moneyline (Underdog Value)</div>
        <div class="bet-guide-body">
          <div class="bet-guide-steps">
            <div class="bet-guide-step"><span class="step-num">1</span> Open your sportsbook's <strong>live betting</strong> section</div>
            <div class="bet-guide-step"><span class="step-num">2</span> Find the NBA game listed</div>
            <div class="bet-guide-step"><span class="step-num">3</span> Look for <strong>Moneyline</strong> on the <strong>trailing</strong> team</div>
            <div class="bet-guide-step"><span class="step-num">4</span> The signal tells you which team (the one currently behind)</div>
            <div class="bet-guide-step"><span class="step-num">5</span> Bet that team's moneyline. Odds MUST be positive (underdog). The higher the better.</div>
          </div>
          <div class="bet-guide-example">
            <strong>Example:</strong> Signal says "MIA to WIN (underdog)" with estimated odds +350<br>
            You bet: Heat moneyline at +350. Risk $100 to win $350 if Miami comes back. Low hit rate but big payouts.
          </div>
          <div class="bet-guide-odds-note">
            <strong>About plus odds:</strong> These are always positive (you win more than you risk).
            The system estimates the underdog price but actual odds vary. Only bet if odds are plus (+). The higher the plus odds,
            the bigger the payout when it hits. This is a low-frequency, high-reward signal.
          </div>
        </div>
      </div>

      <div class="bet-guide-block">
        <div class="bet-guide-header"><span class="signal-type-badge q4-total">Q4 TOTAL</span> Live 4th Quarter Total Points</div>
        <div class="bet-guide-body">
          <div class="bet-guide-steps">
            <div class="bet-guide-step"><span class="step-num">1</span> Open your sportsbook's <strong>live betting</strong> section</div>
            <div class="bet-guide-step"><span class="step-num">2</span> Find the NBA game, then look for <strong>Quarter props</strong> or <strong>Q4 markets</strong></div>
            <div class="bet-guide-step"><span class="step-num">3</span> Look for <strong>Q4 Total</strong> (4th Quarter Over/Under)</div>
            <div class="bet-guide-step"><span class="step-num">4</span> The signal tells you OVER or UNDER and the line number</div>
            <div class="bet-guide-step"><span class="step-num">5</span> Bet the indicated direction at the line shown. Odds should be around <strong>-110</strong></div>
          </div>
          <div class="bet-guide-example">
            <strong>Example:</strong> Signal says "Q4 OVER 54.5"<br>
            You bet: 4th Quarter Over 54.5 at -110 odds. If Q4 has 55+ combined points, you win. Risk $110 to win $100.
          </div>
          <div class="bet-guide-odds-note">
            <strong>About -110 odds:</strong> Same as spreads, -110 is the standard juice for totals bets at all major sportsbooks.
            Not all books offer Q4-specific totals -- check game props or quarter props. Some books may only offer full-game live totals.
          </div>
        </div>
      </div>
    </div>

    <div class="guide-section">
      <h3>Understanding the Odds in This System</h3>
      <div class="highlight-box info">
        <strong>Are the -110 odds just assumed?</strong><br>
        No. For <strong>spread</strong> and <strong>totals</strong> bets, -110 is the actual standard sportsbook price.
        It's not an estimate -- it's what you'll see at virtually every major sportsbook. This is the "juice" or "vig" that
        sportsbooks charge (4.76% margin). You need to win 52.4% of bets at -110 to break even. Our spread signals win at 71.9%
        and total signals at 70.5%, both far above break-even.
        <br><br>
        For <strong>moneyline</strong> bets (ML Leader and ML Trailer), the odds are <em>estimated</em> from the game state
        using probability models. These will differ from book to book and change throughout the game. The system only fires
        ML signals when the model's edge exceeds the estimated market price, so even with odds variance, the edge should persist.
        Always shop multiple sportsbooks for the best available price.
      </div>
    </div>

    <div class="guide-section">
      <h3>Quick Reference</h3>
      <table class="data-table" style="font-size:13px">
        <thead>
          <tr>
            <th>Signal</th>
            <th>What to Bet</th>
            <th>Where to Find It</th>
            <th>Expected Odds</th>
            <th>Sizing</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="signal-type-badge spread">SPREAD</span></td>
            <td>Team + spread line shown</td>
            <td>Live Betting > Point Spread</td>
            <td>-110 (standard)</td>
            <td>1-2% of bankroll</td>
          </tr>
          <tr>
            <td><span class="signal-type-badge ml-leader">ML LEADER</span></td>
            <td>Leading team moneyline</td>
            <td>Live Betting > Moneyline</td>
            <td>Variable (shown on signal)</td>
            <td>2-3% of bankroll</td>
          </tr>
          <tr>
            <td><span class="signal-type-badge ml-trailer">ML TRAILER</span></td>
            <td>Trailing team moneyline</td>
            <td>Live Betting > Moneyline</td>
            <td>Plus odds only (shown on signal)</td>
            <td>0.5-1% of bankroll</td>
          </tr>
          <tr>
            <td><span class="signal-type-badge q4-total">Q4 TOTAL</span></td>
            <td>Q4 Over or Under + line shown</td>
            <td>Live Betting > Quarter Props > Q4 Total</td>
            <td>-110 (standard)</td>
            <td>1-2% of bankroll</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="guide-section">
      <h3>Bankroll Management</h3>
      <div class="highlight-box">
        <ul style="margin:0;padding-left:20px">
          <li><strong>Spread & Q4 Total:</strong> Risk 1-2% of bankroll per signal (1 unit = 1% of bankroll)</li>
          <li><strong>ML Leader:</strong> Risk 2-3% of bankroll (96% accuracy warrants larger sizing)</li>
          <li><strong>ML Trailer:</strong> Risk 0.5-1% of bankroll (low hit rate, high payout -- keep stakes small)</li>
          <li><strong>Never</strong> risk more than 5% of bankroll on a single bet</li>
          <li>Size all bets based on risk amount (the amount you lose if wrong), not the potential payout</li>
        </ul>
      </div>
      <div class="highlight-box warning">
        <strong>Disclaimer:</strong> All results shown are from strict walk-forward out-of-sample testing.
        The model was trained on 2021-22 season data and tested on 2022-23 data with zero look-ahead bias.
        Past performance does not guarantee future results. Gamble responsibly.
      </div>
    </div>
  </div>

</div>

<!-- ============================================================ -->
<!-- SCRIPTS                                                       -->
<!-- ============================================================ -->
<script src="js/nba-api.js"></script>
<script src="js/q3-terminal-engine.js"></script>
<script src="js/main.js"></script>

</body>
</html>
