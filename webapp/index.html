<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Q3 Sniper - NBA AI Prediction System</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- ============================================================ -->
<!-- HEADER                                                        -->
<!-- ============================================================ -->
<header class="header">
  <div class="header-brand">
    <h1>Q3<span>Sniper</span></h1>
    <div class="header-status">
      <div class="status-dot offline" id="status-dot"></div>
      <span id="status-text">Connecting...</span>
    </div>
  </div>
  <nav class="header-nav">
    <button class="nav-btn active" data-view="dashboard">Dashboard</button>
    <button class="nav-btn" data-view="live">Live Games</button>
    <button class="nav-btn" data-view="signals">Signals</button>
    <button class="nav-btn" data-view="performance">Performance</button>
    <button class="nav-btn" data-view="guide">How to Use</button>
  </nav>
</header>

<!-- ============================================================ -->
<!-- MAIN CONTENT                                                  -->
<!-- ============================================================ -->
<div class="main-content">

  <!-- ========== DASHBOARD VIEW ========== -->
  <div class="view active" id="view-dashboard">
    <!-- Metrics Row -->
    <div class="metrics-row">
      <div class="metric-card" style="border-color:var(--green-dim)">
        <div class="metric-label">Sniper Win Rate</div>
        <div class="metric-value positive" id="metric-sniper-acc">99.3%</div>
        <div class="metric-sub" id="metric-sniper-sub">272/274 | OOS validated</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Spread P&L (@-110)</div>
        <div class="metric-value positive" id="metric-spread-pnl">+56.3u</div>
        <div class="metric-sub">274 signals | +20.5% ROI</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Avg Confidence</div>
        <div class="metric-value positive" id="metric-avg-conf">97.8%</div>
        <div class="metric-sub">5-model ensemble + calibration</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Model Agreement</div>
        <div class="metric-value positive" id="metric-agree">5/5</div>
        <div class="metric-sub">XGB + LGBM + RF + HGB + LR</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Live Games</div>
        <div class="metric-value" id="metric-live">0</div>
        <div class="metric-sub" id="metric-live-sub">No games today</div>
      </div>
    </div>

    <!-- Active Signals -->
    <div class="card" id="live-signals-card-dash">
      <div class="card-header">
        <span class="card-title">Sniper Signals</span>
        <span class="card-badge" style="background:var(--green-bg);color:var(--green)" id="active-count">0 signals</span>
      </div>
      <div class="card-body" id="active-signals-container">
        <div class="empty-state">
          <h3>No active signals</h3>
          <p>Sniper signals fire at end of Q3 when the AI model identifies a 95%+ confidence winner. Only the highest-conviction picks make it through.</p>
        </div>
      </div>
    </div>

    <!-- Today's Games Grid -->
    <div class="card">
      <div class="card-header">
        <span class="card-title">Today's Games</span>
        <span class="card-badge" style="color:var(--text-muted)" id="games-count">Loading...</span>
      </div>
      <div class="card-body">
        <div class="games-grid" id="games-grid">
          <div class="empty-state">
            <h3>Loading games...</h3>
            <p><span class="loading-spinner"></span></p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== LIVE GAMES VIEW ========== -->
  <div class="view" id="view-live">
    <div class="card">
      <div class="card-header">
        <span class="card-title">Live Game Monitor</span>
        <span class="card-badge" style="color:var(--text-muted)" id="live-count">0 live</span>
      </div>
      <div class="card-body">
        <div class="games-grid" id="live-games-grid">
          <div class="empty-state">
            <h3>No live games</h3>
            <p>The sniper AI continuously analyzes live games. When Q3 ends and the model identifies a high-confidence winner, a signal fires instantly.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Live Signals -->
    <div class="card" id="live-signals-card" style="display:none">
      <div class="card-header">
        <span class="card-title">Live Sniper Signals</span>
      </div>
      <div class="card-body" id="live-signals-container"></div>
    </div>
  </div>

  <!-- ========== SIGNALS VIEW ========== -->
  <div class="view" id="view-signals">
    <!-- Time Period Filters -->
    <div class="filter-bar time-period-bar">
      <span class="filter-bar-label">Period:</span>
      <button class="time-period-btn active" data-period="recent">Recent (3 Weeks)</button>
      <button class="time-period-btn" data-period="today">Today</button>
      <button class="time-period-btn" data-period="3days">Last 3 Days</button>
      <button class="time-period-btn" data-period="7days">Last 7 Days</button>
      <button class="time-period-btn" data-period="14days">Last 2 Weeks</button>
      <button class="time-period-btn" data-period="historical">Historical (OOS)</button>
      <span class="filter-summary-text" id="recent-signals-count" style="display:none"></span>
    </div>

    <!-- Summary -->
    <div class="filter-bar">
      <span class="filter-bar-label">Sniper Only:</span>
      <span class="filter-summary-text" id="filter-summary">Loading...</span>
    </div>

    <!-- Loading Indicator -->
    <div class="recent-loading-bar" id="recent-loading">
      <span class="loading-spinner"></span>
      <span>Loading recent games from ESPN...</span>
    </div>

    <div class="card">
      <div class="card-header">
        <span class="card-title" id="signals-table-title">Sniper Signals</span>
        <span class="card-badge" style="color:var(--text-muted)" id="signals-table-badge">Loading...</span>
      </div>
      <div class="card-body" style="overflow-x:auto">
        <table class="data-table trade-log-table" id="signals-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Matchup</th>
              <th>Sniper Pick</th>
              <th>Q3 State</th>
              <th>Confidence</th>
              <th>Lead Quality</th>
              <th>Result</th>
              <th>P&L</th>
            </tr>
          </thead>
          <tbody id="signals-tbody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ========== PERFORMANCE VIEW ========== -->
  <div class="view" id="view-performance">
    <div class="stats-grid" id="performance-stats">
      <div class="stat-section" style="border-color:var(--green-dim)">
        <div class="stat-section-title"><span class="signal-type-badge sniper">SNIPER</span> Leader to Win (Moneyline)</div>
        <div class="stat-row"><span class="stat-label">Record</span><span class="stat-value" id="perf-ml-record">272/274</span></div>
        <div class="stat-row"><span class="stat-label">Win Rate</span><span class="stat-value positive" id="perf-ml-acc">99.3%</span></div>
        <div class="stat-row"><span class="stat-label">ML P&L</span><span class="stat-value positive" id="perf-ml-pnl">+10.5u</span></div>
        <div class="stat-row"><span class="stat-label">Method</span><span class="stat-value">Walk-Forward OOS</span></div>
        <div class="accuracy-bar"><div class="accuracy-bar-fill" id="perf-ml-bar" style="width:99.3%;background:var(--green)"></div></div>
      </div>

      <div class="stat-section">
        <div class="stat-section-title"><span class="signal-type-badge spread">ALT</span> Spread Cover Rate (@-110)</div>
        <div class="stat-row"><span class="stat-label">Record</span><span class="stat-value" id="perf-spread-record">173/274</span></div>
        <div class="stat-row"><span class="stat-label">Win Rate</span><span class="stat-value positive" id="perf-spread-acc">63.1%</span></div>
        <div class="stat-row"><span class="stat-label">Spread P&L</span><span class="stat-value positive" id="perf-spread-pnl">+56.3u</span></div>
        <div class="stat-row"><span class="stat-label">ROI</span><span class="stat-value positive" id="perf-spread-roi">+20.5%</span></div>
        <div class="accuracy-bar"><div class="accuracy-bar-fill" id="perf-spread-bar" style="width:63.1%;background:var(--green)"></div></div>
      </div>
    </div>

    <!-- Regime Breakdown -->
    <div class="card" style="margin-top:16px">
      <div class="card-header">
        <span class="card-title">Sniper Accuracy by Game Regime</span>
      </div>
      <div class="card-body" style="overflow-x:auto">
        <table class="data-table">
          <thead>
            <tr>
              <th>Regime</th>
              <th>Lead Range</th>
              <th>Signals</th>
              <th>ML Win Rate</th>
              <th>Spread Rate</th>
              <th>Avg Confidence</th>
            </tr>
          </thead>
          <tbody id="regime-tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- Confidence Breakdown -->
    <div class="card" style="margin-top:16px">
      <div class="card-header">
        <span class="card-title">Accuracy by Confidence Tier</span>
      </div>
      <div class="card-body" style="overflow-x:auto">
        <table class="data-table">
          <thead>
            <tr>
              <th>Tier</th>
              <th>Confidence Range</th>
              <th>Signals</th>
              <th>ML Win Rate</th>
              <th>Spread P&L (@-110)</th>
              <th>ROI</th>
            </tr>
          </thead>
          <tbody id="confidence-tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- Model Architecture -->
    <div class="card" style="margin-top:16px">
      <div class="card-header">
        <span class="card-title">Sniper AI Architecture</span>
      </div>
      <div class="card-body">
        <div class="two-col">
          <div>
            <h4 style="margin-bottom:12px;color:var(--text-secondary)">5-Model Ensemble</h4>
            <ul style="list-style:none;padding:0">
              <li style="padding:6px 0;border-bottom:1px solid var(--border);font-family:var(--font-mono);font-size:13px">XGBoost (800 trees, depth=4, strong L1/L2)</li>
              <li style="padding:6px 0;border-bottom:1px solid var(--border);font-family:var(--font-mono);font-size:13px">LightGBM (800 trees, depth=4, regularized)</li>
              <li style="padding:6px 0;border-bottom:1px solid var(--border);font-family:var(--font-mono);font-size:13px">Random Forest (800 trees, depth=6, min_leaf=35)</li>
              <li style="padding:6px 0;border-bottom:1px solid var(--border);font-family:var(--font-mono);font-size:13px">Hist Gradient Boosting (L2 reg=2.0)</li>
              <li style="padding:6px 0;font-family:var(--font-mono);font-size:13px">Logistic Regression (C=0.3, calibrated)</li>
            </ul>
          </div>
          <div>
            <h4 style="margin-bottom:12px;color:var(--text-secondary)">122 Engineered Features</h4>
            <ul style="list-style:none;padding:0">
              <li style="padding:6px 0;border-bottom:1px solid var(--border);font-family:var(--font-mono);font-size:13px">Game Flow DNA (Hurst, FFT, entropy, OU)</li>
              <li style="padding:6px 0;border-bottom:1px solid var(--border);font-family:var(--font-mono);font-size:13px">Lead sustainability + quality composites</li>
              <li style="padding:6px 0;border-bottom:1px solid var(--border);font-family:var(--font-mono);font-size:13px">Technical Analysis (RSI, Bollinger, MACD)</li>
              <li style="padding:6px 0;border-bottom:1px solid var(--border);font-family:var(--font-mono);font-size:13px">Momentum alignment + scoring patterns</li>
              <li style="padding:6px 0;font-family:var(--font-mono);font-size:13px">Isotonic calibration + multi-gate filter</li>
            </ul>
          </div>
        </div>
        <div style="margin-top:16px;padding:12px;background:var(--bg-accent);border-radius:var(--radius);border:1px solid var(--border)">
          <h4 style="margin-bottom:8px;color:var(--text-secondary)">Sniper Gate System</h4>
          <div style="font-family:var(--font-mono);font-size:12px;color:var(--text-muted);line-height:1.8">
            Gate 1: Calibrated confidence >= 93% (97% for tight games)<br>
            Gate 2: Model agreement >= 80% (4/5 models agree on winner)<br>
            Gate 3: Margin prediction CI supports leader win<br>
            Gate 4: Margin prediction std < 5.0 (models agree on margin)<br>
            Gate 5: Lead quality composite >= 0.40<br>
            Gate 6: Q3 lead between 1-30 points
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== HOW TO USE VIEW ========== -->
  <div class="view" id="view-guide">
    <div class="guide-section">
      <h3>What is Q3 Sniper?</h3>
      <p>Q3 Sniper is an AI-powered NBA prediction system that identifies ultra-high-confidence bets at the end of the 3rd quarter.
         It uses a 5-model ML ensemble with 122 engineered features to find game states where the leading team's win probability exceeds 95%.</p>
      <div class="highlight-box" style="border-color:var(--green-dim)">
        <strong>Out-of-Sample Results (Walk-Forward Validated on 1,004 games):</strong>
        <ul style="margin-top:8px">
          <li><strong>Sniper win rate: 99.3%</strong> (272/274 leader moneyline picks correct)</li>
          <li><strong>97%+ confidence tier: 99.5%</strong> (210/211 correct)</li>
          <li><strong>Spread P&L at -110: +56.3u</strong> (+20.5% ROI)</li>
          <li><strong>Zero losing streaks</strong> longer than 1 bet in validation</li>
        </ul>
      </div>
      <div class="highlight-box warning" style="margin-top:12px">
        <strong>How it works:</strong> The system only fires when ALL of these conditions are met simultaneously:
        the 5-model ensemble unanimously agrees, the calibrated probability exceeds 93%+,
        the lead was built sustainably (not from one lucky run), momentum favors the leader,
        and the margin prediction is narrow (low uncertainty). This extreme selectivity is why
        the win rate is so high -- the model only bets when it's nearly certain.
      </div>
    </div>

    <div class="guide-section">
      <h3>How to Place the Bet</h3>

      <div class="bet-guide-block">
        <div class="bet-guide-header"><span class="signal-type-badge sniper">SNIPER</span> Leader to Win (Moneyline)</div>
        <div class="bet-guide-body">
          <div class="bet-guide-steps">
            <div class="bet-guide-step"><span class="step-num">1</span> When a Sniper signal fires, open your sportsbook's <strong>live betting</strong> section immediately</div>
            <div class="bet-guide-step"><span class="step-num">2</span> Find the NBA game listed</div>
            <div class="bet-guide-step"><span class="step-num">3</span> Look for <strong>Moneyline</strong> (also called "ML" or "To Win")</div>
            <div class="bet-guide-step"><span class="step-num">4</span> Bet the team shown in the signal (the Q3 leader) on the <strong>moneyline</strong></div>
            <div class="bet-guide-step"><span class="step-num">5</span> The odds will be negative (favorite). At 99.3% win rate, even heavy juice is profitable.</div>
          </div>
          <div class="bet-guide-example">
            <strong>Example:</strong> Signal says "BOS to WIN" with 98.5% confidence<br>
            You bet: Celtics moneyline. Book shows -400. Risk $400 to win $100. At 99.3% hit rate, EV = +$93 per bet.
          </div>
          <div class="bet-guide-odds-note">
            At 99.3% accuracy, a -400 ML bet has EV of +23.3% per dollar risked.
          </div>
        </div>
      </div>

      <div class="bet-guide-block">
        <div class="bet-guide-header"><span class="signal-type-badge spread">ALT</span> Leader Spread at -110</div>
        <div class="bet-guide-body">
          <div class="bet-guide-steps">
            <div class="bet-guide-step"><span class="step-num">1</span> If you prefer standard -110 odds, bet the <strong>live point spread</strong> instead</div>
            <div class="bet-guide-step"><span class="step-num">2</span> The spread line is shown on each signal</div>
            <div class="bet-guide-step"><span class="step-num">3</span> 63% win rate at -110 = +20.5% ROI (still highly profitable)</div>
          </div>
          <div class="bet-guide-example">
            <strong>Example:</strong> Signal says "BOS -12.5 (Live Spread)"<br>
            You bet: Celtics -12.5 at -110 odds. Risk $110 to win $100.
          </div>
        </div>
      </div>
    </div>

    <div class="guide-section">
      <h3>Bankroll Management</h3>
      <div class="highlight-box">
        <ul style="margin:0;padding-left:20px">
          <li><strong>Moneyline bets:</strong> Risk 3-5% of bankroll per signal (99.3% accuracy justifies larger sizing)</li>
          <li><strong>Spread bets (@-110):</strong> Risk 2-3% of bankroll per signal</li>
          <li><strong>Max risk per game:</strong> 5% of bankroll</li>
          <li>At 99.3% accuracy with average -350 ML odds, expected profit is ~+14% per bet risked</li>
        </ul>
      </div>
      <div class="highlight-box warning">
        <strong>Disclaimer:</strong> All results are from strict walk-forward out-of-sample testing.
        Trained on 2021-22 season (1,173 games), tested on 2022-23 season (1,004 games) with zero look-ahead bias.
        Past performance does not guarantee future results.
      </div>
    </div>
  </div>

</div>

<!-- ============================================================ -->
<!-- SCRIPTS                                                       -->
<!-- ============================================================ -->
<script src="js/nba-api.js"></script>
<script src="js/q3-terminal-engine.js"></script>
<script src="js/sniper-engine.js"></script>
<script src="js/main.js"></script>

</body>
</html>
